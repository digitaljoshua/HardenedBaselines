# Baseline Verification

## Automated Verification with Desired State Configuration
The Test-DscConfiguration cmdlet allows you to run a configuration in read-only mode to determine all the resources in the desired state and all resources not in the desired state.  The example below demonstrates this procedure for the Windows Server 2016 baseline from Microsoft.
1.	Dot source the configuration to make the PS Session aware of the configuration function.
    ```PowerShell 
    PS C:\Users\PIAdmin\Documents\Utilities>. .\Harden_DSC_Microsoft_WindowsServer2016_MemberBaseline.ps1
    ```
2.	Compile the configuration on the target machine to generate an MOF file.
    ```PowersShell
    PS C:\Users\PIAdmin\Documents\Utilities>Harden_DSC_Microsoft_WindowsServer2016_MemberBaseline
    ```
3.	Test the configuration with the Test-DscConfiguration cmdlet 
    ```PowerShell
    PS C:\Users\PIAdmin\Documents\Utilities>$result = Test-DscConfiguration -Path .\Harden_DSC_Microsoft_WindowsServer2016_MemberBaseline -Verbose
    ```
4.	View resources not in the desired state by using the ResourcesNotInDesiredState property of the result.
    ```PowerShell
    PS C:\Users\PIAdmin\Documents\Utilities>$result.ResourcesNotInDesiredState
    ```

If the MOF file is available from the original setup, then steps (1) & (2) can be skipped.  Instead, Test-DscConfiguration can be run directly against the MOF file without recompiling by specifying the folder with the MOF file from when the configuration was applied in the Path parameter.

The procedure above must be repeated for each DSC Configuration file to verify all settings.


## Manual Verification with Reference Files
### Operating System Configuration
Manual verification of OS configuration is available with native PowerShell comdlets as demonstrated in Write-ReferenceWindowsFiles.ps1.  The script will generate the following artifacts:
- Enabled and Disabled Firewall Rules: Reference-Windows-FirewallRules.txt
- Disabled and Enabled Features: Reference-Windows-Features.txt
- Required Services: Reference-Windows-Services.txt
- Required Software Objects: Reference-Windows-Programs.txt
- Windows Defender Access Control (WDAC) Policy: Reference-Windows-FilePublisherRules-FallbackHash.xml

### PI System Configuration
Manual verification of the PI System components is available with the PI Security Audit tools.  The PI Security Audit Tools Report is generated by following the steps in Section 3.3.10.  
- PISecurityAudit_DetailReport_YYYY-MM-DD_HH-MM-SS.html
Leveraging the Export-PISecConfig cmdlet of the PI Security Audit Tool will generate the artifacts below.
    ```PowerShell
    PS C:\Users\PIAdmin\Documents\Setup\PISecurityAudit>Export-PISecConfig -PIDataArchiveName myPIDA -DataItem All
    ```
- HardenedConfig-PIDataArchive-PIDatabaseSecurity.csv
- HardenedConfig-PIDataArchive-PIFirewall.csv
- HardenedConfig-PIDataArchive-PIUsers.csv
- HardenedConfig-PIDataArchive-PIGroups.csv
- HardenedConfig-PIDataArchive-PIMappings.csv
- HardenedConfig-PIDataArchive-PITrusts.csv
- HardenedConfig-PIDataArchive-PIServerAuthenticationPolicy.csv


## Navigation
Previous: [Security Control Methods](Security%20Control%20Methods.md)  
[Table of Contents](Table%20of%20Contents.md)  
Next: [Security Policy Configuration Tools](Security%20Policy%20Configuration%20Tools.md)